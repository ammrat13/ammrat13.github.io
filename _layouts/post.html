---
layout: base
stylesheet: post
libs: [postsel]
---

{% comment %} Find the index of this post {% endcomment %}
{% for post in site.posts %}
    {% if post.id == page.id %}
        {% comment %}
            For some reason, Liquid indexes at 1 for for loops.
        {% endcomment %}
        {% assign postIdx = forloop.index | minus: 1 %}
        {% break %}
    {% endif %}
{% endfor %}

{% comment %}
    Calculate the starting index. Account for very early posts by subtracting
    more.
{% endcomment %}
{% assign numPosts = site.posts | size %}
{% assign postNumSel = site.data.post_select.postNumSel %}
{% assign halfNumSel = postNumSel | divided_by: 2 %}
{% assign earlyPostCorr = halfNumSel | minus: numPosts | plus: postIdx | plus: 1 | at_least: 0 %}
{% assign startIdx = postIdx | minus: halfNumSel | minus: earlyPostCorr | at_least: 0 %}


{% comment %}
    Have a separate paragraph for the title due to spacing.
{% endcomment %}
<p>
    <h1>{{page.title}}</h1>
    <em class="text-muted">{{page.date | date: "%-d %B %Y"}}</em>
</p>

<div id="postContent">
    {{content}}
</div>
<hr/>

<p>
    <h2>Related Posts</h2>
</p>
{% include post_select.html start=startIdx num=postNumSel skipId=page.id %}
